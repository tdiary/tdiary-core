<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
	<meta name="Author" content="TADA Tadashi">
	<link rev="MADE" href="mailto:sho@spc.gr.jp">
	<link rel="INDEX" href="http://www.tdiary.net/">
	<meta http-equiv="content-style-type" content="text/css">
	<link rel="stylesheet" href="doc.css" type="text/css" media="all">
	<title>tDiary: How to use plugin</title>
</head>
<body>
<h1>tDiary<br><span style="font-size:medium">プラグインの使い方</span></h1>

<p><strong>※プラグインの作り方については、<a href="HOWTO-make-plugin.html">HOWTO-make-plugin.html</a>を参照してください。</strong></p>

<div class="section">
<p>　プラグインはtDiary 1.3.1以降で使えるようになった、システムに機能を追加する仕組みです。プラグインは<a href="http://www.tdiary.net/">tDiary.Net</a>から入手することができます。また、tDiaryフルセットを利用している場合には、misc/pluginディレクトリに単独に配布されているのと同等のものが含まれています。これらの.rbファイルを、ファイルごとインストール先にあるpluginディレクトリに移動することで、利用できるようになります。</p>

<p>　プラグインにはさまざまなものがありますが、日記中に自動的に何かの文字列を埋め込んだり、特殊な処理をさせるのが主な目的です。また、特定のプラグインを作ることで、tDiaryのメッセージをカスタマイズすることもできます。</p>

<p>　以下では、プラグインについてその「使い方」「プラグイン集について」を説明します。なお、.rbファイルのことを「プラグインファイル」、実際に日記中で呼び出して使う機能(主にRubyのメソッド)のことを「プラグイン」と呼びます。ひとつのプラグインファイルは、複数のプラグインを含みます。</p>
</div>

<h2><span class="title">プラグインの使い方</span></h2>
<div class="body">
<div class="section">
<p>　プラグインを使うには、そのプラグインを含んだプラグインファイルが、tDiaryインストール先にあるpluginディレクトリになければなりません。あらかじめ使いたいプラグインファイルをpluginディレクトリにコピーしておく必要があります。プラグインの中には高機能で処理に時間のかかるものも含まれているので、必要でないプラグインまでコピーすると、日記の表示が遅くなったりします。必要なプラグインだけを使うように、きちんと選択してください。</p>

<p>　プラグインは、eRubyと呼ばれる文法を使って、日記のタイトルや本文、ヘッダやフッタに埋め込むことで利用できます。「calendar」や「navi」というデフォルトプラグインは、すでにヘッダの中で使っているので見たことがあるでしょう。プラグインの機能を日記に埋め込むときのもっとも簡単な書式は以下のとおりです。</p>

<pre>
&lt;%=プラグイン名%&gt;
</pre>

<p>　たとえば、カレンダーを埋め込むプラグイン「calendar」は、以下のようにして記述します。</p>

<pre>
&lt;%=calendar%&gt;
</pre>

<p>　プラグインの種類によっては、以下のようにパラメタを指定して動作を変えることもできます。</p>

<pre>
&lt;%=プラグイン名 パラメタ1, パラメタ2, ...%&gt;
</pre>

<p>　各プラグインがどのようなパラメタを利用できるかは、プラグインファイルの先頭の方に書かれていることがあります。</p>

<p>　プラグインを使えるのは、日記のタイトルと本文、およびヘッダとフッタです。日付フォーマットで使えるものもあります。すべてのページに表示したい場合にはヘッダかフッタを、その日の日記にだけ使いたい場合にはタイトルや本文に使います。また、ツッコミには使えません。</p>
</div>
</div>

<h2><span class="title">デフォルトプラグインの説明</span></h2>
<div class="body">
<div class="section">
<p>　「デフォルトプラグイン」というプラグインファイル「00default.rb」がすでにpluginディレクトリに置いてあります。まず、これらのプラグインについて説明します。</p>
</div>

<h3 class="subtitle">naviプラグイン</h3>
<div class="section">
<p>　日記ページの先頭にある、「トップ」「最新」「更新」などのナビゲーションボタンを表示するためのプラグインです。パラメタはありません。ヘッダやフッタに埋め込むことで、ページによって最適なボタンを表示します。このプラグインをどこかに埋め込んでおかないと、日記の更新ができなくなってしまいます。</p>
</div>

<div class="section">
<p>※もしnaviプラグインを埋め込み忘れてしまい、日記の更新ができなくなってしまったら、日記のURLの後ろに「update.rb」(環境によっては「update.cgi」など)を付けて呼び出してみましょう。更新ページが表示されます。</p>
</div>

<div class="section">
<p>※naviプラグインは、更新や設定のページに内部的に埋め込まれています。もとの挙動を大きく変えるような改造をすると、操作性を大きく損ねるおそれがあるので注意してください。</p>
</div>

<h3 class="subtitle">navi_userプラグイン</h3>
<div class="section">
<p>　naviプラグインから内部的に呼び出されているプラグインですが、単独で使うこともできます。このプラグインは、ナビゲーションボタンのうち、日記閲覧者にのみ必要なボタン(「トップ」「最新」「&lt;前日」「翌日&gt;」)を表示します。これを使うことで、「更新」のような日記オーナーにだけ必要なボタンを表示させないなどのカスタマイズを行えます。</p>
</div>

<div class="section">
<p>　パラメタはありませんが、naviプラグインを使う場合に比べて、前後のPタグが省略されるので、以下のようにして埋め込むと良いでしょう。</p>
</div>

<div class="section">
<pre>
&lt;p class=&quot;adminmenu&quot;&gt;&lt;%=navi_user%&gt;&lt;/p&gt;
</pre>
</div>

<h3 class="subtitle">navi_adminプラグイン</h3>
<div class="section">
<p>　navi_userプラグインと反対に、管理用に必要なボタン「更新」「設定」を表示します。使い方はnavi_userと同じです。</p>
</div>

<h3 class="subtitle">calendarプラグイン</h3>
<div class="section">
<p>　カレンダーを表示します。日記が書かれている月のみをリストします。ヘッダやフッタに埋め込んで使います。パラメタはありません。このプラグインをどこかに入れておかないと、日記閲覧者は過去の日記を読むことができなくなってしまいます。</p>
</div>

<h3 class="subtitle">insertプラグイン</h3>
<div class="section">
<p>　外部ファイルを日記に読み込みます。主な用途は、ヘッダやフッタに、すでにある定型ファイルを挿入したいような場合です。そのままの形で埋め込むので、挿入するファイルはHTMLでなければなりません。パラメタとしてひとつのファイル名をとるので、以下のように使います。</p>
</div>

<div class="section">
<pre>
&lt;%=insert 'menu.html'%&gt;
</pre>
</div>

<div class="section">
<p>　このプラグインは、ファイルにアクセスするため、tdiary.confで@secureがfalseに設定されていないと利用できません。</p>
</div>

<h3 class="subtitle">myプラグイン</h3>
<div class="section">
<p>　日記本文中で、自分の日記内へのリンクを簡単に作成します。&lt;a href=&quot;〜&quot;&gt;...&lt;/a&gt;とやってもよいのですが、こちらの方がサーバの引っ越しやmod_rewriteを利用してURLを変更した場合などに強くできます。</p>
<p>　最初のパラメタにリンク先の日付とアンカーを「YYYYMMDD#pXX」(YYYY年MM月DD日のXX番目のセクション)や「YYYYMMDD#cXX」(YYYY年MM月DD日のXX番目のツッコミ)のような形式で指定します。2番目のパラメタには、リンクにする文字列を指定します。3番目のパラメタには、必要であればリンクタイトルを指定できます。</p>
</div>

<div class="section">
<pre>
&lt;%=my '20020301#c01', 'そのツッコミ' %&gt;はひどい(笑)。
</pre>
</div>

<h2><span class="title">プラグイン集について</span></h2>
<div class="section">
<p>　続いて、プラグイン集について説明します。プラグイン集は、tDiaryユーザが作った数々のプラグインを集めたものです。tDiaryフルパッケージをインストールした場合にはmisc/pluginディレクトリにありますし、そうでない場合にも<a href="http://www.tdiary.net/">tDiary.Net</a>から入手することができます。これらのプラグインファイルは、は自分でpluginディレクトリにコピーして利用します。</p>

<p>　ここでは、プラグイン集に収録されているプラグインのうち、いくつか代表的なものについて簡単に解説します。これら以外にも、たくさんのプラグインが収録されています。使い方の説明は、個々のプラグインファイルの先頭を参照してください。</p>
</div>

<h3 class="subtitle">title_listプラグイン</h3>
<div class="section">
<p>　title_list.rbファイルに含まれています。現在表示中の月のタイトル一覧を表示します。ヘッダやフッタに埋め込んで使います。単に一覧を表示するだけなので、きちんとレイアウトするにはtableタグを使ったり、CSS(テーマファイル)を書き換える等の工夫が必要になります。</p>
</div>

<h3 class="subtitle">srcプラグイン</h3>
<div class="section">
<p>　src.rbファイルに含まれています。日記本文に外部にあるファイルを埋め込むために使います。デフォルトプラグインのinsertとの違いは、insertがファイルの中身をそのまま埋め込むのに対し、srcは「&lt;」「&gt;」「&amp;」などのHTML的に意味のある文字がそのまま表示されるように「&amp;lt;」「&amp;gt;」「&amp;amp;」等で置換してくれる点です。このため、srcプラグインは普通のテキストファイルやプログラムのリストを埋め込むのに適しています。</p>
</div>

<div class="section">
<p>　なお、insertと同様、このプラグインも@secureがfalseでないと使えません。</p>
</div>

<h3 class="subtitle">src_inlineプラグイン</h3>
<div class="section">
<p>　src.rbファイルに含まれています。srcプラグインと違い、パラメタに直接文字列を指定するタイプです。何がうれしいかと言うと、srcと同様、HTML的に意味のある文字をエスケープしてくれる点です。1行だけの文字列であれば以下のように使えますが、</p>
</div>

<div class="section">
<pre>
&lt;%=src_inline 'HTMLのタグは「&lt;」で始まり「&gt;」で終わります'%&gt;
</pre>
</div>

<div class="section">
<p>複数行に渡るような場合には以下のようにすると楽でしょう(Rubyのヒアドキュメント機能を活用)。</p>
</div>

<div class="section">
<pre>
&lt;%=src_inline &lt;&lt;TEXT
HTMLのタグは「&lt;」で始まり「&gt;」で終わります。
このため、文章中に「&lt;」を書くときは「&amp;lt;」、
「&gt;」を書くときは「&amp;gt;」と書かねばなりませ
んが、src・src_inlineプラグインではそのよう
なことを考えなくても大丈夫です。
TEXT
%&gt;
</pre>
</div>

<div class="section">
<p>　また、挿入する文章に空改行が含まれている場合は注意が必要です。tDiaryの文法では、空改行はセクションの終了を意味するので、このままだとそこでセクションが切られてしまいます。空改行がある場合には、空白をひとつ入れる等の工夫をして下さい。</p>
</div>

<h3 class="subtitle">calendarプラグイン(ドロップダウンリスト)</h3>
<div class="section">
<p>　dropdown_calendar.rbには、デフォルトのcalendarを置き換えるプラグインが含まれています。このように、同名のプラグインを作ると、元のプラグインを置き換えることが可能です。</p>
</div>

<div class="section">
<p>　dropdown_calendar.rbのcalendarプラグインは、一覧形式でカレンダーを表示するデフォルトのcalendarと違い、ドロップダウンリストとしてカレンダーを表示します。長年日記を続けて、デフォルトのカレンダーが大きくなりすぎたら、このプラグインを使ってみるといいかも知れません。使い方はデフォルトのcalendarと全く同じです。</p>
</div>

<h3 class="subtitle">editプラグイン</h3>
<div class="section">
<p>　日毎表示の時に、ナビゲーションボタンの「更新」を「編集」に置き換えるプラグインです。標準の「更新」ボタンは今日の日記を追加するモードになりますが、editプラグインを入れて「編集」にすることで、現在表示されている日記を直接編集できるようになります。</p>
</div>

<h3 class="subtitle">calendar2プラグイン(kitaj作)</h3>
<div class="section">
<p>　一般的なカレンダーと同じ表形式を使って、過去の日記にアクセスできるようにするプラグインです。ヘッダやフッタに入れて使います。詳しくはcalendar2.rbを見てください。</p>
</div>

<h3 class="subtitle">recent_listプラグイン(kitaj作)</h3>
<div class="section">
<p>　最近書いた日記のタイトル、サブタイトルを表示します。title_listプラグインとの違いは、常に最新の日記を対象にする点です。ヘッダやフッタに入れて使いますが、テーブルを使うか、テーマを書き換えてレイアウトを工夫しないと使えないでしょう。詳しくはrecent_list.rbを見てください。</p>
</div>

<h3 class="subtitle">recent_commentプラグイン(zoe作)</h3>
<div class="section">
<p>　最近あったツッコミを新しい順にリストアップします。ヘッダやフッタに入れて使います。詳しくはrecent_comment.rbを見てください。</p>
</div>

<h3 class="subtitle">comment_rankプラグイン(zoe作)</h3>
<div class="section">
<p>　ツッコミの数でランキングを作ります。ヘッダやフッタに入れて使います。詳しくはcomment_rank.rbを見てください。</p>
</div>

</div>

</body>
</html>
